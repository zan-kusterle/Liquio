<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="A liquid democracy where anyone can vote on anything">
		<meta name="author" content="Å½an Kusterle">

		<meta property="og:image" content="https://liqu.io/images/logo.png" />
		<meta property="og:description" content="A liquid democracy where anyone can vote on anything." />
		<meta property="og:url" content="https://liqu.io/" />
		<meta property="og:title" content="Liquio" />

		<link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/icons/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/icons/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="/icons/manifest.json">
		<link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5">
		<meta name="theme-color" content="#1f8dd6">

		<%= if assigns[:title] do %>
			<title><%= @title %></title>
		<% else %>
			<title>Liquio</title>
		<% end %>

		<link rel="stylesheet" href="<%= static_path(@conn, "/css/app.css") %>">

		<script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>

		<link rel="import" href="<%= static_path(@conn, "/polymer/main.html") %>">

		<script src="/bower_components/moment/min/locales.js"></script>

		<script>
			var defaultVueData = {}
		</script>

		<%= render "google_analytics.html", conn: @conn %>
	</head>

	<body>
		<script>
			<%
				token = if user = Guardian.Plug.current_resource(@conn) do
					Guardian.Plug.current_token(Guardian.Plug.sign_in(@conn, user))
				else
					nil
				end
			%>
			var token = <%= if token do %>'<%= token %>'<% else %><%= "null" %><% end %>;
		</script>
		<div id="app" class="container">
			<div class="header">
				<div class="header-contents">
					<div class="pure-g">
						<div class="pure-u-1 pure-u-sm-5-6">
							<a href="/" class="logo"><img src="/images/logo.svg"></a>
							<h3 class="tagline">A liquid democracy where anyone can vote on anything.</h3>
						</div>

						<div class="pure-u-1 pure-u-sm-1-6">
							<div class="actions">
								<%= if user = Guardian.Plug.current_resource(@conn) do %>
									<a href="/identities/<%= user.username %>"><i class="fa fa-user" aria-hidden="true"></i> <%= user.name %></a>
									<a href="/logout"><i class="fa fa-sign-out" aria-hidden="true"></i> Logout</a>
								<% else %>
									<a href="/login"><i class="fa fa-sign-in" aria-hidden="true"></i> Login</a>
								<% end %>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<div class="main-wrap" id="main-wrap">
				<div class="scrollable">
					<%= if get_flash(@conn, :error) != nil do %>
						<p class="alert alert-error" role="alert"<%= if assigns[:width] do %> style="max-width: <%= @width %>px;"<% end %>><%= get_flash(@conn, :error) %></p>
					<% else %>
						<%= if get_flash(@conn, :info) != nil do %>
							<p class="alert alert-info" role="alert"<%= if assigns[:width] do %> style="max-width: <%= @width %>px;"<% end %>><%= get_flash(@conn, :info) %></p>
						<% end %>
					<% end %>
					
					<div class="main-container">
						<%= render @view_module, @view_template, assigns %>
					</div>
				</div>
			</div>
		</div>

		<script type="text/x-template" id="results_template"><%= render Liquio.VueView, "results.html", conn: @conn %></script>
		<script type="text/x-template" id="own_vote_template"><%= render Liquio.VueView, "own_vote.html", conn: @conn %></script>
		<script type="text/x-template" id="liquio_node_template"><%= render Liquio.VueView, "big.html", conn: @conn %></script>
		<script type="text/x-template" id="liquio_inline_template"><%= render Liquio.VueView, "inline.html", conn: @conn %></script>
		<script type="text/x-template" id="liquio_list_template"><%= render Liquio.VueView, "list.html", conn: @conn %></script>
		<script type="text/x-template" id="options_template"><%= render Liquio.VueView, "options.html", conn: @conn %></script>
		<script type="text/x-template" id="liquio_full_template"><%= render Liquio.VueView, "full.html", conn: @conn %></script>

		<script src="/bower_components/vue/dist/vue.js"></script>
		<script src="/bower_components/vue-resource/dist/vue-resource.js"></script>
		<script src="<%= static_path(@conn, "/js/app.js") %>"></script>
	</body>
</html>
