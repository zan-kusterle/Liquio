<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="A liquid democracy where anyone can vote on anything">
		<meta name="author" content="Zan Kusterle">

		<%= if assigns[:title] do %>
			<title><%= @title %></title>
		<% else %>
			<title>Liquio</title>
		<% end %>

		<link rel="icon" href="/favicon.ico" />

		<link rel="stylesheet" href="<%= static_path(@conn, "/css/app.css") %>">
	</head>

	<body>
		<div class="container">


			<div class="header">
				<div class="header-contents">
					<div class="pure-g">
						<div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-8">
							<a href="/" class="logo"><img src="/images/logo.png"></a>
						</div>

						<div class="pure-u-1 pure-u-md-1-2 pure-u-lg-3-8">
							<form method="GET" action="/search" class="search-container">
								<input type="search" class="search" placeholder="Search" name="query"<%= if assigns[:query] do %> value="<%= @query %>"<% end %>>
							</form>
						</div>

						<div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-2">
							<div class="actions">
								<%= if user = Guardian.Plug.current_resource(@conn) do %>
									<a href="/logout"><i class="fa fa-sign-out" aria-hidden="true"></i> Logout</a>
									<%= if is_in_trust_metric?(user) do %>
										<a href="/identities/<%= user.id %>"><i class="fa fa-user" aria-hidden="true"></i> <%= user.name %></a>
									<% else %>
										<a href="/identities/<%= user.id %>">
											<span><i class="fa fa-user" aria-hidden="true"></i> <%= user.name %></span>
											<span class="not-in-trust-metric">not in trust metric</span>
										</a>
									<% end %>
								<% else %>
									<a href="/login"><i class="fa fa-sign-in" aria-hidden="true"></i> Login</a>
								<% end %>

								<a href="/polls/new"><i class="fa fa-plus" aria-hidden="true"></i> Create</a>
								<a href="/explore"><i class="fa fa-eye" aria-hidden="true"></i> Explore</a>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<div class="main-wrap">
				<%= if get_flash(@conn, :error) != nil do %>
					<p class="alert alert-error" role="alert"><%= get_flash(@conn, :error) %></p>
				<% else %>
					<%= if get_flash(@conn, :info) != nil do %>
						<p class="alert alert-info" role="alert"><%= get_flash(@conn, :info) %></p>					
					<% end %>
				<% end %>

				<%= render_existing @view_module, "before_#{@view_template}", assigns %>

				<main role="main" class="main">
					<%= render @view_module, @view_template, assigns %>
				</main>
			</div>
		</div>
	</body>
</html>
